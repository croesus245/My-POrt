<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FraudShield — Case Study</title>
    <meta name="description" content="Real-time fraud detection with delayed label reconciliation, drift monitoring, and incident simulation.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/favicon.png">
    
    <!-- Open Graph -->
    <meta property="og:title" content="FraudShield — Case Study">
    <meta property="og:description" content="Real-time fraud detection with delayed label reconciliation, drift monitoring, and incident simulation.">
    <meta property="og:type" content="article">
    <meta property="og:image" content="https://croesusml.vercel.app/assets/profile.jpg">
    <meta property="og:url" content="https://croesusml.vercel.app/work/fraudshield.html">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to content</a>
    
    <header class="header">
        <div class="header-container">
            <div class="header-left">
                <a href="../index.html" class="logo">Abdul-Sobur Ayinde</a>
                <span class="role">ML Systems Engineer</span>
            </div>
            <nav class="nav">
                <a href="../work.html" class="nav-link active">Work</a>
                <a href="../proof.html" class="nav-link">Proof</a>
                <a href="../writing.html" class="nav-link">Writing</a>
                <a href="../resume.pdf" class="nav-link" target="_blank">Resume</a>
                <a href="../contact.html" class="nav-link">Contact</a>
            </nav>
            <div class="header-right">
                <a href="mailto:abdulsobur245@gmail.com" class="email-link">abdulsobur245@gmail.com</a>
                <button class="hamburger" id="hamburger" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
        <nav class="mobile-nav" id="mobile-nav">
            <a href="../work.html" class="mobile-nav-link">Work</a>
            <a href="../proof.html" class="mobile-nav-link">Proof</a>
            <a href="../writing.html" class="mobile-nav-link">Writing</a>
            <a href="../resume.pdf" class="mobile-nav-link" target="_blank">Resume</a>
            <a href="../contact.html" class="mobile-nav-link">Contact</a>
        </nav>
    </header>

    <main id="main-content" class="case-study">
        <div class="container">
            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <a href="../work.html">Work</a>
                <span>/</span>
                <span>FraudShield</span>
            </nav>

            <!-- Hero -->
            <header class="case-hero">
                <span class="case-lane">MLOps</span>
                <h1 class="case-title">FraudShield</h1>
                <p class="case-tagline">A learning project for understanding fraud detection systems—delayed labels, drift, and what happens when things break.</p>
                
                <div class="case-badges">
                    <span class="badge">CI-Eval</span>
                    <span class="badge">Drift</span>
                    <span class="badge">Cost</span>
                    <span class="badge">Latency</span>
                    <span class="badge">Postmortem</span>
                    <span class="badge">Model Card</span>
                </div>

                <div class="validation-context">
                    <strong>Note:</strong> This is a personal project with synthetic data. The benchmarks are from my own load tests on a 4-core VM. Not production traffic. <a href="#benchmarks">See methodology →</a>
                </div>

                <div class="case-links">
                    <a href="https://github.com/croesus245/fraudshield-mlops-system" class="btn btn-primary" target="_blank">View Repository</a>
                    <a href="#demo" class="btn btn-outline">Local Demo</a>
                    <a href="https://github.com/croesus245/fraudshield-mlops-system/blob/main/docs/eval_report.md" class="btn btn-outline" target="_blank">Eval Report</a>
                    <a href="https://github.com/croesus245/fraudshield-mlops-system/blob/main/docs/INCIDENT_POSTMORTEM.md" class="btn btn-outline" target="_blank">Postmortem</a>
                </div>
            </header>

            <!-- Try It -->
            <section class="case-section try-it-box" id="demo">
                <h2>Interactive Demo</h2>
                <p class="demo-disclaimer"><strong>This is fake</strong> — it's a simulation showing what the API responses look like. Clone the repo if you want to run the real thing locally.</p>
                
                <!-- Interactive Transaction Scorer -->
                <div class="demo-container">
                    <div class="demo-header">
                        <h3>Score a Transaction</h3>
                        <div class="demo-status">
                            <span class="demo-status-dot"></span>
                            <span>Simulated API</span>
                        </div>
                    </div>
                    <div class="demo-body">
                        <div class="demo-input-row">
                            <div class="demo-input-group">
                                <label>Amount ($)</label>
                                <input type="number" class="demo-input" id="txn-amount" value="847.50" min="0" step="0.01">
                            </div>
                            <div class="demo-input-group">
                                <label>Channel</label>
                                <select class="demo-input" id="txn-channel">
                                    <option value="card_not_present">Card Not Present</option>
                                    <option value="card_present">Card Present</option>
                                    <option value="mobile">Mobile App</option>
                                    <option value="atm">ATM</option>
                                </select>
                            </div>
                            <div class="demo-input-group">
                                <label>Merchant Category</label>
                                <select class="demo-input" id="txn-merchant">
                                    <option value="travel">Travel & Airlines</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="grocery">Grocery</option>
                                    <option value="gas">Gas Station</option>
                                    <option value="crypto">Crypto Exchange</option>
                                </select>
                            </div>
                        </div>
                        <div class="demo-input-row">
                            <div class="demo-input-group">
                                <label>User Velocity (txns/hr)</label>
                                <input type="number" class="demo-input" id="txn-velocity" value="3" min="0">
                            </div>
                            <div class="demo-input-group">
                                <label>Account Age (days)</label>
                                <input type="number" class="demo-input" id="txn-age" value="45" min="0">
                            </div>
                            <div class="demo-input-group">
                                <label>New Device?</label>
                                <select class="demo-input" id="txn-device">
                                    <option value="no">No (Known Device)</option>
                                    <option value="yes">Yes (First Time)</option>
                                </select>
                            </div>
                        </div>
                        <button class="demo-btn" id="score-btn-interactive" onclick="scoreTransactionInteractive()">
                            Score Transaction
                        </button>
                        
                        <div id="fraud-result" class="demo-result" style="display: none;">
                            <div class="demo-result-header">
                                <span class="demo-result-title">API Response</span>
                                <span id="fraud-decision-badge" class="demo-result-badge"></span>
                            </div>
                            <pre id="fraud-json" class="demo-json"></pre>
                            <div class="demo-metrics">
                                <div class="demo-metric">
                                    <span id="fraud-score" class="demo-metric-value">—</span>
                                    <span class="demo-metric-label">Risk Score</span>
                                </div>
                                <div class="demo-metric">
                                    <span id="fraud-latency" class="demo-metric-value">—</span>
                                    <span class="demo-metric-label">Latency</span>
                                </div>
                                <div class="demo-metric">
                                    <span id="fraud-reasons" class="demo-metric-value">—</span>
                                    <span class="demo-metric-label">Risk Factors</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Drift Simulator -->
                <div class="demo-container">
                    <div class="demo-header">
                        <h3>Drift Simulation</h3>
                        <div class="demo-status">
                            <span class="demo-status-dot"></span>
                            <span>Monitoring</span>
                        </div>
                    </div>
                    <div class="demo-body">
                        <p style="color: var(--text-secondary); margin-bottom: 16px;">Simulate a distribution shift and see how the monitoring system responds.</p>
                        <button class="demo-btn demo-btn-secondary" onclick="triggerDriftInteractive()">
                            Inject Drift Event
                        </button>
                        <div id="drift-result" class="demo-result" style="display: none;">
                            <div class="demo-result-header">
                                <span class="demo-result-title">Drift Alert</span>
                                <span id="drift-severity-badge" class="demo-result-badge review">ALERT</span>
                            </div>
                            <pre id="drift-json" class="demo-json"></pre>
                        </div>
                    </div>
                </div>

                <h4>Quick Start</h4>
                <div class="code-block">
                    <pre><code>git clone https://github.com/croesus245/fraudshield-mlops-system && cd fraudshield-mlops-system
make setup && make serve       # API on localhost:8000
make simulate-stream           # Generate + stream synthetic transactions
make eval                      # Full evaluation suite
make drift-sim                 # Trigger drift simulation</code></pre>
                </div>
            </section>

            <!-- Content -->
            <div class="case-content">
                <!-- Problem -->
                <section class="case-section">
                    <h2>Why I Built This</h2>
                    <p>Most fraud detection tutorials show you a classifier and call it done. But real fraud systems have problems that tutorials skip:</p>
                    <ul class="problem-facts">
                        <li><strong>Labels arrive late:</strong> Chargebacks take 30-90 days. You can't just do train/test split.</li>
                        <li><strong>Fraudsters adapt:</strong> Patterns change constantly. Your model from last month might be useless.</li>
                        <li><strong>Class imbalance is extreme:</strong> 0.1-1% fraud rate. Accuracy is a useless metric.</li>
                        <li><strong>You need to know when it's failing:</strong> Drift detection isn't optional.</li>
                    </ul>
                    
                    <div class="why-different-box">
                        <p><strong>What I learned:</strong> The model is the easy part. Label reconciliation, drift monitoring, and knowing when to retrain—that's the real work.</p>
                    </div>
                </section>

                <!-- Architecture -->
                <section class="case-section">
                    <h2>Architecture</h2>
                    <div class="architecture-diagram">
                        <pre>
┌──────────────┐    ┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│ Stream Ingest│───▶│ Streaming    │───▶│ Scoring      │───▶│ Decision     │
│ (Kafka or    │    │ Aggregates   │    │ Service      │    │ Engine       │
│ mock gen)    │    │ + Cache      │    │ (FastAPI)    │    │ (Rules+Model)│
└──────────────┘    └──────────────┘    └──────────────┘    └──────────────┘
                           │                   │                   │
                           ▼                   │                   ▼
                    ┌──────────────┐           │            ┌──────────────┐
                    │ Online Cache │           │            │ Action       │
                    │ (Redis)      │           │            │ (Allow/Review│
                    └──────────────┘           │            │ /Block)      │
                                               │            └──────────────┘
                                               ▼
┌──────────────┐    ┌──────────────┐    ┌──────────────┐
│ Prediction   │───▶│ Label        │───▶│ Drift        │
│ Log          │    │ Reconciler   │    │ Monitor      │
│ (audit trail)│    │ (30–90d lag) │    │              │
└──────────────┘    └──────────────┘    └──────────────┘
                                               │
                           ┌───────────────────┘
                           ▼
                    ┌──────────────┐
                    │ Retraining   │
                    │ Trigger      │
                    └──────────────┘
                        </pre>
                    </div>

                    <!-- Label Reconciliation Flow -->
                    <h3>Label Reconciliation Flow</h3>
                    <div class="reconciliation-flow">
                        <div class="flow-step">1. Predict</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">2. Log (txn_id, score, decision)</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">3. Wait 30–90d</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">4. Label batch arrives</div>
                        <div class="flow-arrow">→</div>
                        <div class="flow-step">5. Join & evaluate</div>
                    </div>

                    <h3>Components</h3>
                    <ul>
                        <li><strong>Streaming aggregates:</strong> Velocity features per user/merchant/device (1m/10m/1h/24h windows)</li>
                        <li><strong>Online feature cache:</strong> Redis for fast lookups; offline Parquet store for training</li>
                        <li><strong>Entity embeddings:</strong> User/merchant vectors from transaction co-occurrence (SVD, 32-dim). Computed offline weekly, served via cache.</li>
                        <li><strong>Scoring API:</strong> FastAPI + XGBoost → risk score + decision + reason codes</li>
                        <li><strong>Decision engine:</strong> Model score + rule overrides (velocity limits, blocklists, amount thresholds)</li>
                        <li><strong>Prediction log:</strong> Store inputs/score/decision/model_version for audits and reconciliation</li>
                        <li><strong>Label reconciler:</strong> Joins confirmed labels back to prior predictions (30–90 day lag)</li>
                        <li><strong>Drift monitor:</strong> PSI on predictions, KS on 20 key features, base-rate tracking, null-rate alerts</li>
                        <li><strong>Retrain trigger:</strong> Automatic job when drift thresholds trip (+ optional human approval gate)</li>
                    </ul>
                </section>

                <!-- Constraints -->
                <section class="case-section" id="benchmarks">
                    <h2>Benchmarks</h2>
                    <div class="benchmark-methodology">
                        <strong>How I tested this:</strong> Locust load testing against the FastAPI service running on my 4-core VM. Synthetic transaction payloads. This tells you the code works and roughly how fast—not how it would perform in a real production environment with real data.
                    </div>
                    <div class="constraints-grid">
                        <div class="constraint">
                            <span class="constraint-label">Latency Target</span>
                            <span class="constraint-value">< 50ms p95</span>
                            <span class="constraint-note">Achieved ~45ms in synthetic load test</span>
                        </div>
                        <div class="constraint">
                            <span class="constraint-label">Throughput</span>
                            <span class="constraint-value">~1,200 TPS</span>
                            <span class="constraint-note">Locust load test, single instance</span>
                        </div>
                        <div class="constraint">
                            <span class="constraint-label">Label Delay</span>
                            <span class="constraint-value">30–90 days</span>
                            <span class="constraint-note">Simulated in demo</span>
                        </div>
                        <div class="constraint">
                            <span class="constraint-label">Synthetic Base Rate</span>
                            <span class="constraint-value">2.3% fraud</span>
                            <span class="constraint-note">Higher than prod for stable eval</span>
                        </div>
                    </div>
                </section>

                <!-- Evaluation -->
                <section class="case-section">
                    <h2>Evaluation</h2>
                    
                    <div class="how-measured">
                        <strong>How measured:</strong> Time-based train/test split (80/20). Test set labels reconciled after 45-day simulated delay. Synthetic fraud base rate: 2.3% (higher than production 0.1–1% for stable evaluation). At 0.1% base rate, small synthetic datasets produce unstable PR curves; the system supports lower base rates via scaling the generator.
                    </div>

                    <h3>Operational Metrics (What Fraud Teams Care About)</h3>
                    <p class="threshold-note"><strong>Default threshold:</strong> 0.70 (tuned to cap review queue ~3% while keeping recall >80%)</p>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Value</th>
                                <th>Interpretation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>PR-AUC</strong></td>
                                <td><strong>0.88</strong></td>
                                <td>Primary metric for imbalanced classification</td>
                            </tr>
                            <tr>
                                <td>Recall @ 1% FPR</td>
                                <td>68%</td>
                                <td>Catch rate when only 1% false alarms tolerated</td>
                            </tr>
                            <tr>
                                <td>Precision @ top 0.5% risk</td>
                                <td>71%</td>
                                <td>Hit rate in highest-risk transactions</td>
                            </tr>
                            <tr>
                                <td>Precision @ threshold</td>
                                <td>67%</td>
                                <td>Of flagged transactions, 2/3 are actual fraud</td>
                            </tr>
                            <tr>
                                <td>Recall @ threshold</td>
                                <td>83%</td>
                                <td>Catch 83% of all fraud</td>
                            </tr>
                            <tr>
                                <td>Manual review queue</td>
                                <td>~2.8% of volume</td>
                                <td>Threshold tuned to cap queue at ~3% while keeping recall >80%</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Model Comparison</h3>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>PR-AUC</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Baseline (XGBoost + manual features)</td>
                                <td>0.82</td>
                                <td>No embeddings</td>
                            </tr>
                            <tr class="highlight">
                                <td>Final (XGBoost + entity embeddings)</td>
                                <td>0.88</td>
                                <td>Current model</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="eval-note-small"><em>ROC-AUC: 0.98+ (high due to synthetic separability—not a reliable metric for imbalanced fraud)</em></p>

                    <h3>Slice Performance</h3>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Slice</th>
                                <th>PR-AUC</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>High-value transactions (> $500)</td>
                                <td>0.85</td>
                                <td>Pass</td>
                            </tr>
                            <tr>
                                <td>New users (< 30 days)</td>
                                <td>0.79</td>
                                <td>Pass</td>
                            </tr>
                            <tr>
                                <td>International transactions</td>
                                <td>0.84</td>
                                <td>Pass</td>
                            </tr>
                            <tr>
                                <td>Card-not-present</td>
                                <td>0.86</td>
                                <td>Pass</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="eval-note">CI-ready regression gate: All slices must achieve PR-AUC ≥ 0.75. No slice regression > 5%.</p>
                    
                    <div class="ci-evidence">
                        <strong>Example CI Gate Output</strong><br>
                        <span style="opacity: 0.7;">(Shown as example—run <code>make eval</code> locally to see real output)</span><br>
                        Workflow: <code>eval-gate.yml</code> · Eval Gate: PASS · Worst slice: <code>New users PR-AUC = 0.79</code> · Regressions: <code>0</code>
                    </div>
                </section>

                <!-- Monitoring -->
                <section class="case-section">
                    <h2>Monitoring & Drift</h2>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Method</th>
                                <th>Alert Threshold</th>
                                <th>Response</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Prediction score drift</td>
                                <td>PSI on score distribution</td>
                                <td>> 0.1</td>
                                <td>Investigate feature drift</td>
                            </tr>
                            <tr>
                                <td>Feature drift</td>
                                <td>KS test on 20 key features</td>
                                <td>p < 0.01 on >3 features</td>
                                <td>Check upstream data</td>
                            </tr>
                            <tr>
                                <td>Base rate drift</td>
                                <td>7-day rolling fraud rate</td>
                                <td>> 20% deviation from baseline</td>
                                <td>Trigger recalibration</td>
                            </tr>
                            <tr>
                                <td>Feature null-rate spike</td>
                                <td>Null % per feature</td>
                                <td>> 5% increase</td>
                                <td>Check data pipeline</td>
                            </tr>
                            <tr>
                                <td>Schema change</td>
                                <td>Contract validation</td>
                                <td>Any schema mismatch</td>
                                <td>Block pipeline, alert</td>
                            </tr>
                            <tr>
                                <td>Feature computation lag</td>
                                <td>Streaming lag metrics</td>
                                <td>> 5 min behind</td>
                                <td>Scale workers</td>
                            </tr>
                            <tr>
                                <td>Label freshness</td>
                                <td>Days since last label batch</td>
                                <td>> 45 days</td>
                                <td>Check label pipeline</td>
                            </tr>
                            <tr>
                                <td>Latency p95</td>
                                <td>Service metrics</td>
                                <td>> 50ms</td>
                                <td>Scale or optimize</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="eval-note">See <a href="https://github.com/croesus245/fraudshield-mlops-system/blob/main/docs/DRIFT_RUNBOOK.md" target="_blank">Drift Runbook</a> for detailed response procedures.</p>
                    <p class="ownership-note"><strong>Ownership:</strong> On-call owns drift/latency alerts. Data Eng owns schema/lag. ML Eng owns recalibration + model updates.</p>
                </section>

                <!-- Cost/Latency -->
                <section class="case-section">
                    <h2>Cost & Latency</h2>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <span class="metric-value">~15ms</span>
                            <span class="metric-label">p50 Latency</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value">~45ms</span>
                            <span class="metric-label">p95 Latency</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value">~1.2K</span>
                            <span class="metric-label">TPS (single instance)</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value">~$360</span>
                            <span class="metric-label">Monthly (estimated)</span>
                        </div>
                    </div>
                    <div class="how-measured">
                        <strong>How measured:</strong>
                        <ul>
                            <li><strong>Latency:</strong> uvicorn workers=4, batch=1, 1KB payload, 1000-request benchmark on local machine</li>
                            <li><strong>TPS:</strong> Single c5.xlarge equivalent, no batching. Scales linearly with instances.</li>
                            <li><strong>Cost:</strong> AWS pricing estimate: 2× c5.xlarge ($248) + Redis cache.t3.medium ($25) + storage/egress (~$90). Does not include Kafka (use managed or self-host).</li>
                        </ul>
                        <p><em>Note: Production deployment would need load testing with realistic traffic patterns.</em></p>
                    </div>
                </section>

                <!-- Failure Modes -->
                <section class="case-section">
                    <h2>Failure Modes</h2>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Failure Mode</th>
                                <th>Likelihood</th>
                                <th>Impact</th>
                                <th>Mitigation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Model scores all low-risk</td>
                                <td>Medium</td>
                                <td>High</td>
                                <td>Minimum fraud rate alert</td>
                            </tr>
                            <tr>
                                <td>Latency spike</td>
                                <td>Medium</td>
                                <td>Medium</td>
                                <td>Circuit breaker + rule fallback</td>
                            </tr>
                            <tr>
                                <td>Label pipeline breaks</td>
                                <td>Low</td>
                                <td>High</td>
                                <td>Label freshness alert (>45 days)</td>
                            </tr>
                            <tr>
                                <td>Adversarial fraud pattern</td>
                                <td>High</td>
                                <td>High</td>
                                <td>Drift detection + rapid retrain</td>
                            </tr>
                            <tr>
                                <td>Reason-code drift / feature leakage</td>
                                <td>Low</td>
                                <td>Medium</td>
                                <td>Feature importance drift checks (SHAP optional) + top feature review</td>
                            </tr>
                            <tr>
                                <td>Upstream schema change</td>
                                <td>Medium</td>
                                <td>High</td>
                                <td>Data contract validation blocks pipeline</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="residual-risk">
                        <strong>Residual Risk:</strong> The system cannot detect zero-day fraud patterns until labeled examples arrive (30+ day lag). Mitigation: rule-based fallback for anomalous transactions + human review queue.
                    </div>
                </section>

                <!-- Visual Proof -->
                <section class="case-section" id="visual-proof">
                    <h2>Visual Proof</h2>
                    <p class="proof-intro">Screenshots from actual benchmark runs and monitoring simulations.</p>
                    
                    <div class="proof-gallery">
                        <figure class="proof-figure">
                            <div class="proof-placeholder" data-type="chart">
                                <span class="placeholder-icon">[chart]</span>
                                <span class="placeholder-label">Load Test Chart</span>
                                <code>make benchmark</code>
                            </div>
                            <figcaption>Locust dashboard: ~1.2K TPS sustained, p95 &lt; 50ms</figcaption>
                        </figure>
                        
                        <figure class="proof-figure">
                            <div class="proof-placeholder" data-type="alert">
                                <span class="placeholder-icon">[alert]</span>
                                <span class="placeholder-label">Drift Alert</span>
                                <code>make drift-sim</code>
                            </div>
                            <figcaption>PSI threshold breach triggering retraining workflow</figcaption>
                        </figure>
                        
                        <figure class="proof-figure">
                            <div class="proof-placeholder" data-type="ci">
                                <span class="placeholder-icon">[pass]</span>
                                <span class="placeholder-label">CI Eval Gate</span>
                                <code>.github/workflows/</code>
                            </div>
                            <figcaption>GitHub Actions eval gate with slice regression checks</figcaption>
                        </figure>
                    </div>
                    
                    <p class="proof-note"><em>Run <code>make benchmark</code> locally to generate your own. Screenshots coming soon.</em></p>
                </section>

                <!-- Incident Simulation -->
                <section class="case-section">
                    <h2>Incident Simulation</h2>
                    <div class="incident-box">
                        <h3>What I Broke</h3>
                        <p>Injected a synthetic fraud pattern shift mid-stream: new fraud type targeting a previously safe merchant category (simulated "travel" category attack).</p>
                        
                        <h3>What Happened</h3>
                        <ul>
                            <li>Drift monitor detected PSI spike (0.15 > 0.1 threshold)</li>
                            <li>Feature KS test flagged <code>merchant_category</code> distribution shift</li>
                            <li>Slice analysis showed "travel" category PR-AUC dropped from 0.84 → 0.61</li>
                            <li>Retraining trigger fired automatically</li>
                            <li>New model trained and validated against regression suite</li>
                        </ul>
                        
                        <h3>Postmortem</h3>
                        <p>Full postmortem documented with timeline, root cause, and prevention measures. <a href="https://github.com/croesus245/fraudshield-mlops-system/blob/main/docs/INCIDENT_POSTMORTEM.md" target="_blank">View postmortem →</a></p>
                    </div>
                </section>

                <!-- Assumptions -->
                <section class="case-section assumptions-box">
                    <h2>Assumptions & Limitations</h2>
                    <ul>
                        <li><strong>Synthetic data:</strong> Demo uses generated transactions (no real PII). Patterns are realistic but not from production.</li>
                        <li><strong>Simulated delay:</strong> 30–90 day label lag is simulated by holding back labels, not real chargebacks.</li>
                        <li><strong>Local benchmarks:</strong> Latency/TPS measured on dev machine, not production infrastructure.</li>
                        <li><strong>Mock streaming:</strong> Demo uses mock stream for portability. Kafka consumer/producer stubs included; diagram shows target architecture.</li>
                    </ul>
                </section>

                <!-- Data Contract -->
                <section class="case-section">
                    <h2>Data Contract (excerpt)</h2>
                    <div class="code-block">
                        <pre><code>TransactionEvent:
  required:
    - transaction_id: string (uuid)
    - amount: float (>0)
    - user_id: string
    - merchant_id: string
    - timestamp: datetime (ISO8601)
  optional:
    - device_id: string | null
    - ip_address: string | null
  null_policy: "device_id nullable, others reject on null"</code></pre>
                    </div>
                    <p class="eval-note-small">(Each API request is validated and becomes a TransactionEvent internally.)</p>
                </section>

                <!-- Reason Codes -->
                <section class="case-section">
                    <h2>Reason Codes (sample)</h2>
                    <p>Top reason codes for a high-risk decision:</p>
                    <div class="reason-codes">
                        <span class="reason-code">velocity_user_1h_high</span>
                        <span class="reason-code">new_device_high_amount</span>
                        <span class="reason-code">merchant_category_risk</span>
                        <span class="reason-code">time_since_last_txn_low</span>
                    </div>
                    <p class="reason-code-explain"><code>velocity_user_1h_high</code> — User initiated >N transactions in the last hour (threshold varies by user history)</p>
                    <p class="eval-note-small">Reason codes derived from SHAP values + rule triggers. Used for analyst review and model debugging.</p>
                </section>

                <!-- Links -->
                <section class="case-section">
                    <h2>Artifacts</h2>
                    <div class="artifacts-grid">
                        <a href="https://github.com/croesus245/fraudshield-mlops-system/blob/main/docs/eval_report.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[eval]</span>
                            <span>Eval Report</span>
                        </a>
                        <a href="https://github.com/croesus245/fraudshield-mlops-system/blob/main/docs/DRIFT_RUNBOOK.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[drift]</span>
                            <span>Drift Runbook</span>
                        </a>
                        <a href="https://github.com/croesus245/fraudshield-mlops-system/blob/main/docs/INCIDENT_POSTMORTEM.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[post]</span>
                            <span>Postmortem</span>
                        </a>
                        <a href="https://github.com/croesus245/fraudshield-mlops-system/blob/main/docs/MODEL_CARD.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[card]</span>
                            <span>Model Card</span>
                        </a>
                        <a href="https://github.com/croesus245/fraudshield-mlops-system/blob/main/docs/cost_report.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[cost]</span>
                            <span>Cost Report</span>
                        </a>
                        <a href="https://github.com/croesus245/fraudshield-mlops-system" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[repo]</span>
                            <span>Repository</span>
                        </a>
                    </div>
                </section>
            </div>

            <!-- Navigation -->
            <nav class="case-nav">
                <a href="../work.html" class="case-nav-link">← Back to Work</a>
                <a href="securerag.html" class="case-nav-link">Next: SecureRAG →</a>
            </nav>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>© 2026 Abdul-Sobur Ayinde</p>
                <div class="footer-links">
                    <a href="https://github.com/croesus245" target="_blank">GitHub</a>
                    <a href="https://www.linkedin.com/in/ayinde-abdul-sobur-o-604205272" target="_blank">LinkedIn</a>
                    <a href="https://youtube.com/@ayinde.thecreator" target="_blank">YouTube</a>
                    <a href="https://twitter.com/ayindebuilds" target="_blank">Twitter</a>
                    <a href="../contact.html">Contact</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="../app.js"></script>
    <script>
        // Interactive Transaction Scorer
        function scoreTransactionInteractive() {
            const btn = document.getElementById('score-btn-interactive');
            btn.classList.add('loading');
            btn.disabled = true;
            
            // Simulate API latency
            setTimeout(() => {
            const amount = parseFloat(document.getElementById('txn-amount').value) || 0;
            const channel = document.getElementById('txn-channel').value;
            const merchant = document.getElementById('txn-merchant').value;
            const velocity = parseInt(document.getElementById('txn-velocity').value) || 0;
            const accountAge = parseInt(document.getElementById('txn-age').value) || 0;
            const newDevice = document.getElementById('txn-device').value === 'yes';
            
            // Calculate risk score based on inputs
            let score = 0.1;
            let reasons = [];
            
            // Amount risk
            if (amount > 1000) { score += 0.25; reasons.push("high_value_transaction"); }
            else if (amount > 500) { score += 0.15; reasons.push("elevated_amount"); }
            
            // Channel risk
            if (channel === 'card_not_present') { score += 0.1; reasons.push("cnp_risk"); }
            
            // Merchant category risk
            if (merchant === 'crypto') { score += 0.25; reasons.push("high_risk_merchant_category"); }
            else if (merchant === 'travel' || merchant === 'electronics') { score += 0.1; reasons.push("elevated_merchant_category"); }
            
            // Velocity risk
            if (velocity > 5) { score += 0.2; reasons.push("velocity_spike_detected"); }
            else if (velocity > 3) { score += 0.1; reasons.push("elevated_velocity"); }
            
            // Account age risk
            if (accountAge < 7) { score += 0.2; reasons.push("new_account"); }
            else if (accountAge < 30) { score += 0.1; reasons.push("young_account"); }
            
            // New device risk
            if (newDevice) { score += 0.15; reasons.push("new_device_fingerprint"); }
            
            // Cap score at 0.99
            score = Math.min(0.99, score);
            score = Math.round(score * 100) / 100;
            
            // Determine decision
            let decision = 'allow';
            if (score >= 0.7) decision = 'block';
            else if (score >= 0.4) decision = 'review';
            
            // Simulate latency
            const latency = Math.floor(Math.random() * 25) + 18;
            
            const response = {
                transaction_id: "txn_" + Math.random().toString(36).substr(2, 9),
                score: score,
                decision: decision,
                reason_codes: reasons,
                model_version: "xgb_v0.3.1",
                latency_ms: latency,
                timestamp: new Date().toISOString()
            };
            
            // Display results
            document.getElementById('fraud-result').style.display = 'block';
            document.getElementById('fraud-json').textContent = JSON.stringify(response, null, 2);
            document.getElementById('fraud-score').textContent = (score * 100).toFixed(0) + '%';
            document.getElementById('fraud-latency').textContent = latency + 'ms';
            document.getElementById('fraud-reasons').textContent = reasons.length;
            
            const badge = document.getElementById('fraud-decision-badge');
            badge.textContent = decision.toUpperCase();
            badge.className = 'demo-result-badge ' + decision;
            
            btn.classList.remove('loading');
            btn.disabled = false;
            }, 400 + Math.random() * 300);
        }
        
        // Drift Simulator
        function triggerDriftInteractive() {
            const psi = (0.15 + Math.random() * 0.15).toFixed(3);
            const ks = (0.08 + Math.random() * 0.1).toFixed(3);
            const severity = parseFloat(psi) > 0.2 ? 'critical' : 'warning';
            
            const alert = {
                alert_type: "DISTRIBUTION_DRIFT_DETECTED",
                severity: severity,
                timestamp: new Date().toISOString(),
                metrics: {
                    psi_score: parseFloat(psi),
                    ks_statistic: parseFloat(ks),
                    threshold_psi: 0.10,
                    threshold_ks: 0.05,
                    drifted_features: [
                        { feature: "merchant_category", psi: parseFloat(psi) },
                        { feature: "velocity_user_1h", psi: (parseFloat(psi) * 0.7).toFixed(3) }
                    ],
                    baseline_period: "2025-12-01 to 2025-12-20",
                    current_period: "2025-12-21 to now",
                    samples_baseline: 50000,
                    samples_current: 12500
                },
                recommended_action: severity === 'critical' ? "TRIGGER_RETRAINING" : "INVESTIGATE_AND_MONITOR",
                runbook: "docs/DRIFT_RUNBOOK.md",
                slack_channel: "#ml-alerts",
                on_call_notified: true
            };
            
            document.getElementById('drift-result').style.display = 'block';
            document.getElementById('drift-json').textContent = JSON.stringify(alert, null, 2);
            
            const badge = document.getElementById('drift-severity-badge');
            badge.textContent = severity.toUpperCase();
            badge.className = 'demo-result-badge ' + (severity === 'critical' ? 'block' : 'review');
        }

        // Demo transaction scenarios (legacy)
        const transactions = [
            { amount: 847.50, user_id: "u_12345", merchant_id: "m_travel_05", channel: "card_not_present", score: 0.73, decision: "review", reasons: ["velocity_user_1h_high", "new_merchant_high_amount"] },
            { amount: 2499.99, user_id: "u_78234", merchant_id: "m_electronics_12", channel: "mobile", score: 0.91, decision: "block", reasons: ["amount_zscore_extreme", "device_first_seen", "geo_anomaly"] },
            { amount: 34.50, user_id: "u_55123", merchant_id: "m_grocery_01", channel: "chip", score: 0.08, decision: "allow", reasons: [] },
            { amount: 199.00, user_id: "u_99821", merchant_id: "m_gaming_08", channel: "card_not_present", score: 0.52, decision: "review", reasons: ["merchant_category_risk", "time_of_day_unusual"] },
            { amount: 5200.00, user_id: "u_00412", merchant_id: "m_jewelry_03", channel: "card_not_present", score: 0.88, decision: "block", reasons: ["high_value_new_merchant", "velocity_spike", "card_not_present_risk"] }
        ];

        let txnIndex = 0;

        function scoreTransaction() {
            const btn = document.getElementById('score-btn');
            btn.classList.add('loading');
            
            setTimeout(() => {
                const txn = transactions[txnIndex % transactions.length];
                txnIndex++;
                
                const request = {
                    amount: txn.amount,
                    user_id: txn.user_id,
                    merchant_id: txn.merchant_id,
                    channel: txn.channel
                };
                
                const response = {
                    score: txn.score,
                    decision: txn.decision,
                    reason_codes: txn.reasons,
                    model_version: "xgb_v0.3.1",
                    latency_ms: Math.floor(Math.random() * 20) + 12
                };
                
                const output = `// POST /predict
${JSON.stringify(request, null, 2)}

// Response (${response.latency_ms}ms)
${JSON.stringify(response, null, 2)}`;
                
                showOutput('Fraud Score Result', output, txn.decision);
                btn.classList.remove('loading');
            }, 300 + Math.random() * 200);
        }

        function triggerDrift() {
            const btn = document.getElementById('drift-btn');
            btn.classList.add('loading');
            
            setTimeout(() => {
                const psi = (0.15 + Math.random() * 0.1).toFixed(3);
                const affectedFeatures = ["merchant_category", "velocity_user_1h", "amount_zscore"];
                const shuffled = affectedFeatures.sort(() => Math.random() - 0.5);
                const driftedFeatures = shuffled.slice(0, Math.floor(Math.random() * 2) + 1);
                
                const alert = {
                    alert_type: "DRIFT_DETECTED",
                    severity: psi > 0.2 ? "critical" : "warning",
                    timestamp: new Date().toISOString(),
                    metrics: {
                        psi_score: parseFloat(psi),
                        threshold: 0.10,
                        drifted_features: driftedFeatures,
                        baseline_period: "2025-12-01 to 2025-12-20",
                        current_period: "2025-12-21 00:00 to now"
                    },
                    recommended_action: psi > 0.2 ? "TRIGGER_RETRAINING" : "INVESTIGATE",
                    runbook_link: "docs/DRIFT_RUNBOOK.md"
                };
                
                const output = `// Drift simulation triggered
// Injecting distribution shift into merchant_category...

// ALERT FIRED
${JSON.stringify(alert, null, 2)}

// Slack notification sent to #ml-alerts`;
                
                showOutput('Drift Alert', output, alert.severity);
                btn.classList.remove('loading');
            }, 500 + Math.random() * 300);
        }

        function showOutput(title, content, status) {
            const output = document.getElementById('demo-output');
            const titleEl = document.getElementById('demo-output-title');
            const contentEl = document.getElementById('demo-output-content');
            
            titleEl.textContent = title;
            contentEl.textContent = content;
            output.style.display = 'block';
            output.className = 'demo-output status-' + status;
            
            output.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function closeDemoOutput() {
            document.getElementById('demo-output').style.display = 'none';
        }
    </script>
    <style>
        .try-it-btn {
            cursor: pointer;
            border: none;
            background: var(--bg-card);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .try-it-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .try-it-btn:active {
            transform: translateY(0);
        }
        .try-it-btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }
        .try-it-btn.loading .try-it-icon {
            animation: pulse 0.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .demo-output {
            margin-top: 1.5rem;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background: var(--bg-card);
            overflow: hidden;
        }
        .demo-output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--accent);
            color: white;
            font-weight: 600;
        }
        .demo-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
            opacity: 0.8;
        }
        .demo-close:hover { opacity: 1; }
        .demo-output pre {
            margin: 0;
            padding: 1rem;
            font-size: 0.85rem;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .demo-output.status-allow { border-color: #22c55e; }
        .demo-output.status-allow .demo-output-header { background: #22c55e; }
        .demo-output.status-review { border-color: #f59e0b; }
        .demo-output.status-review .demo-output-header { background: #f59e0b; }
        .demo-output.status-block { border-color: #ef4444; }
        .demo-output.status-block .demo-output-header { background: #ef4444; }
        .demo-output.status-warning { border-color: #f59e0b; }
        .demo-output.status-warning .demo-output-header { background: #f59e0b; }
        .demo-output.status-critical { border-color: #ef4444; }
        .demo-output.status-critical .demo-output-header { background: #ef4444; }
        .demo-disclaimer {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: #92400e;
        }
        .dataset-citation {
            background: var(--bg-card);
            border-left: 3px solid var(--accent);
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        .dataset-citation a {
            color: var(--accent);
        }
    </style>
</body>
</html>
