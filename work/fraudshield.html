<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FraudShield â€” Case Study</title>
    <meta name="description" content="Real-time fraud detection with delayed label reconciliation, drift monitoring, and incident simulation.">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="header-left">
                <a href="../index.html" class="logo">Abdul-Sobur Ayinde</a>
                <span class="role">ML Systems Engineer</span>
            </div>
            <nav class="nav">
                <a href="../work.html" class="nav-link active">Work</a>
                <a href="../proof.html" class="nav-link">Proof</a>
                <a href="../writing.html" class="nav-link">Writing</a>
                <a href="../contact.html" class="nav-link">Contact</a>
            </nav>
            <div class="header-right">
                <a href="mailto:abdulsobur245@gmail.com" class="email-link">abdulsobur245@gmail.com</a>
                <button class="hamburger" id="hamburger" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
        <nav class="mobile-nav" id="mobile-nav">
            <a href="../work.html" class="mobile-nav-link">Work</a>
            <a href="../proof.html" class="mobile-nav-link">Proof</a>
            <a href="../writing.html" class="mobile-nav-link">Writing</a>
            <a href="../contact.html" class="mobile-nav-link">Contact</a>
        </nav>
    </header>

    <main class="case-study">
        <div class="container">
            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <a href="../work.html">Work</a>
                <span>/</span>
                <span>FraudShield</span>
            </nav>

            <!-- Hero -->
            <header class="case-hero">
                <span class="case-lane">MLOps</span>
                <h1 class="case-title">FraudShield</h1>
                <p class="case-tagline">Real-time fraud scoring with delayed labels (30â€“90 days). Built for drift, extreme imbalance, and incident response.</p>
                
                <div class="case-badges">
                    <span class="badge">CI-Eval</span>
                    <span class="badge">Drift</span>
                    <span class="badge">Cost</span>
                    <span class="badge">Latency</span>
                    <span class="badge">Postmortem</span>
                    <span class="badge">Model Card</span>
                </div>

                <p class="case-credibility"><strong>Everything here is measurable and reproducible:</strong> eval suite, drift thresholds, runbook, and staged incident.</p>

                <div class="case-links">
                    <a href="https://github.com/Croesus245/My-POrt/tree/main/fraudshield" class="btn btn-primary" target="_blank">View Repository â†’</a>
                    <a href="#demo" class="btn btn-outline">Local Demo</a>
                    <a href="https://github.com/Croesus245/My-POrt/blob/main/fraudshield/docs/eval_report.md" class="btn btn-outline" target="_blank">Eval Report</a>
                    <a href="https://github.com/Croesus245/My-POrt/blob/main/fraudshield/docs/postmortem.md" class="btn btn-outline" target="_blank">Read the Postmortem â†’</a>
                </div>
            </header>

            <!-- Try It -->
            <section class="case-section try-it-box" id="demo">
                <h2>Interactive Demo</h2>
                <p class="demo-disclaimer">âš ï¸ <strong>Simulated output</strong> â€” Click to see example API responses. For the real system, clone the repo and run locally.</p>
                <div class="try-it-buttons">
                    <button class="try-it-btn" id="score-btn" onclick="scoreTransaction()">
                        <span class="try-it-icon">ğŸ”</span>
                        <span class="try-it-label">Score a Transaction</span>
                        <span class="try-it-desc">Example: score + decision + reason codes</span>
                    </button>
                    <button class="try-it-btn" id="drift-btn" onclick="triggerDrift()">
                        <span class="try-it-icon">ğŸ“‰</span>
                        <span class="try-it-label">Trigger Drift</span>
                        <span class="try-it-desc">Example: PSI spike and alert format</span>
                    </button>
                </div>

                <!-- Demo Output -->
                <div id="demo-output" class="demo-output" style="display:none;">
                    <div class="demo-output-header">
                        <span id="demo-output-title">Response</span>
                        <button class="demo-close" onclick="closeDemoOutput()">Ã—</button>
                    </div>
                    <pre id="demo-output-content"></pre>
                </div>

                <h4>Sample Request â†’ Response</h4>
                <div class="code-block">
                    <pre><code># Request
curl -X POST localhost:8000/predict \
  -d '{"amount":847.50,"user_id":"u_12345","merchant_id":"m_travel_05","device_id":"d_77","channel":"card_not_present"}'

# Response
{"score":0.73,"decision":"review","reason_codes":["velocity_user_1h_high","new_merchant_high_amount"],"model_version":"xgb_v0.3.1"}</code></pre>
                </div>

                <h4>Quick Start</h4>
                <div class="code-block">
                    <pre><code>git clone https://github.com/Croesus245/My-POrt && cd My-POrt/fraudshield
make setup && make serve       # API on localhost:8000
make simulate-stream           # Generate + stream synthetic transactions
make eval                      # Full evaluation suite
make drift-sim                 # Trigger drift simulation</code></pre>
                </div>
            </section>

            <!-- Content -->
            <div class="case-content">
                <!-- Problem -->
                <section class="case-section">
                    <h2>Problem</h2>
                    <ul class="problem-facts">
                        <li><strong>Adversarial & non-stationary:</strong> Attackers change patterns to bypass detection</li>
                        <li><strong>Delayed labels:</strong> Chargebacks/confirmed fraud arrive 30â€“90 days after the event</li>
                        <li><strong>Extreme imbalance:</strong> Fraud is rare (often 0.1%â€“1% in production systems)â€”accuracy is meaningless</li>
                        <li><strong>Must self-monitor:</strong> System must detect drift and degrade safely when signals shift</li>
                    </ul>
                    
                    <div class="why-different-box">
                        <p><strong>Beyond a classifier:</strong> delayed-label reconciliation, drift monitoring, CI regression gates, and incident runbooks.</p>
                    </div>
                </section>

                <!-- Architecture -->
                <section class="case-section">
                    <h2>Architecture</h2>
                    <div class="architecture-diagram">
                        <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stream Ingestâ”‚â”€â”€â”€â–¶â”‚ Streaming    â”‚â”€â”€â”€â–¶â”‚ Scoring      â”‚â”€â”€â”€â–¶â”‚ Decision     â”‚
â”‚ (Kafka or    â”‚    â”‚ Aggregates   â”‚    â”‚ Service      â”‚    â”‚ Engine       â”‚
â”‚ mock gen)    â”‚    â”‚ + Cache      â”‚    â”‚ (FastAPI)    â”‚    â”‚ (Rules+Model)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                   â”‚                   â”‚
                           â–¼                   â”‚                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Online Cache â”‚           â”‚            â”‚ Action       â”‚
                    â”‚ (Redis)      â”‚           â”‚            â”‚ (Allow/Reviewâ”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚            â”‚ /Block)      â”‚
                                               â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Prediction   â”‚â”€â”€â”€â–¶â”‚ Label        â”‚â”€â”€â”€â–¶â”‚ Drift        â”‚
â”‚ Log          â”‚    â”‚ Reconciler   â”‚    â”‚ Monitor      â”‚
â”‚ (audit trail)â”‚    â”‚ (30â€“90d lag) â”‚    â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Retraining   â”‚
                    â”‚ Trigger      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        </pre>
                    </div>

                    <!-- Label Reconciliation Flow -->
                    <h3>Label Reconciliation Flow</h3>
                    <div class="reconciliation-flow">
                        <div class="flow-step">1. Predict</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">2. Log (txn_id, score, decision)</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">3. Wait 30â€“90d</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">4. Label batch arrives</div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">5. Join & evaluate</div>
                    </div>

                    <h3>Components</h3>
                    <ul>
                        <li><strong>Streaming aggregates:</strong> Velocity features per user/merchant/device (1m/10m/1h/24h windows)</li>
                        <li><strong>Online feature cache:</strong> Redis for fast lookups; offline Parquet store for training</li>
                        <li><strong>Entity embeddings:</strong> User/merchant vectors from transaction co-occurrence (SVD, 32-dim). Computed offline weekly, served via cache.</li>
                        <li><strong>Scoring API:</strong> FastAPI + XGBoost â†’ risk score + decision + reason codes</li>
                        <li><strong>Decision engine:</strong> Model score + rule overrides (velocity limits, blocklists, amount thresholds)</li>
                        <li><strong>Prediction log:</strong> Store inputs/score/decision/model_version for audits and reconciliation</li>
                        <li><strong>Label reconciler:</strong> Joins confirmed labels back to prior predictions (30â€“90 day lag)</li>
                        <li><strong>Drift monitor:</strong> PSI on predictions, KS on 20 key features, base-rate tracking, null-rate alerts</li>
                        <li><strong>Retrain trigger:</strong> Automatic job when drift thresholds trip (+ optional human approval gate)</li>
                    </ul>
                </section>

                <!-- Constraints -->
                <section class="case-section">
                    <h2>Constraints</h2>
                    <div class="constraints-grid">
                        <div class="constraint">
                            <span class="constraint-label">Latency Target</span>
                            <span class="constraint-value">< 50ms p95</span>
                            <span class="constraint-note">Achieved ~45ms in load test</span>
                        </div>
                        <div class="constraint">
                            <span class="constraint-label">Throughput</span>
                            <span class="constraint-value">~1,200 TPS</span>
                            <span class="constraint-note">Single instance, validated in dev</span>
                        </div>
                        <div class="constraint">
                            <span class="constraint-label">Label Delay</span>
                            <span class="constraint-value">30â€“90 days</span>
                            <span class="constraint-note">Simulated in demo</span>
                        </div>
                        <div class="constraint">
                            <span class="constraint-label">Synthetic Base Rate</span>
                            <span class="constraint-value">2.3% fraud</span>
                            <span class="constraint-note">Higher than prod for stable eval</span>
                        </div>
                    </div>
                </section>

                <!-- Evaluation -->
                <section class="case-section">
                    <h2>Evaluation</h2>
                    
                    <div class="how-measured">
                        <strong>How measured:</strong> Time-based train/test split (80/20). Test set labels reconciled after 45-day simulated delay. Synthetic fraud base rate: 2.3% (higher than production 0.1â€“1% for stable evaluation). At 0.1% base rate, small synthetic datasets produce unstable PR curves; the system supports lower base rates via scaling the generator.
                    </div>

                    <h3>Operational Metrics (What Fraud Teams Care About)</h3>
                    <p class="threshold-note"><strong>Default threshold:</strong> 0.70 (tuned to cap review queue ~3% while keeping recall >80%)</p>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Value</th>
                                <th>Interpretation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>PR-AUC</strong></td>
                                <td><strong>0.88</strong></td>
                                <td>Primary metric for imbalanced classification</td>
                            </tr>
                            <tr>
                                <td>Recall @ 1% FPR</td>
                                <td>68%</td>
                                <td>Catch rate when only 1% false alarms tolerated</td>
                            </tr>
                            <tr>
                                <td>Precision @ top 0.5% risk</td>
                                <td>71%</td>
                                <td>Hit rate in highest-risk transactions</td>
                            </tr>
                            <tr>
                                <td>Precision @ threshold</td>
                                <td>67%</td>
                                <td>Of flagged transactions, 2/3 are actual fraud</td>
                            </tr>
                            <tr>
                                <td>Recall @ threshold</td>
                                <td>83%</td>
                                <td>Catch 83% of all fraud</td>
                            </tr>
                            <tr>
                                <td>Manual review queue</td>
                                <td>~2.8% of volume</td>
                                <td>Threshold tuned to cap queue at ~3% while keeping recall >80%</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Model Comparison</h3>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>PR-AUC</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Baseline (XGBoost + manual features)</td>
                                <td>0.82</td>
                                <td>No embeddings</td>
                            </tr>
                            <tr class="highlight">
                                <td>Final (XGBoost + entity embeddings)</td>
                                <td>0.88</td>
                                <td>Current model</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="eval-note-small"><em>ROC-AUC: 0.98+ (high due to synthetic separabilityâ€”not a reliable metric for imbalanced fraud)</em></p>

                    <h3>Slice Performance</h3>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Slice</th>
                                <th>PR-AUC</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>High-value transactions (> $500)</td>
                                <td>0.85</td>
                                <td>âœ“ Pass</td>
                            </tr>
                            <tr>
                                <td>New users (< 30 days)</td>
                                <td>0.79</td>
                                <td>âœ“ Pass</td>
                            </tr>
                            <tr>
                                <td>International transactions</td>
                                <td>0.84</td>
                                <td>âœ“ Pass</td>
                            </tr>
                            <tr>
                                <td>Card-not-present</td>
                                <td>0.86</td>
                                <td>âœ“ Pass</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="eval-note">CI-ready regression gate: All slices must achieve PR-AUC â‰¥ 0.75. No slice regression > 5%.</p>
                    
                    <div class="ci-evidence">
                        <strong>Example CI Gate Output</strong><br>
                        <span style="opacity: 0.7;">(Shown as exampleâ€”run <code>make eval</code> locally to see real output)</span><br>
                        Workflow: <code>eval-gate.yml</code> Â· Eval Gate: âœ… PASS Â· Worst slice: <code>New users PR-AUC = 0.79</code> Â· Regressions: <code>0</code>
                    </div>
                </section>

                <!-- Monitoring -->
                <section class="case-section">
                    <h2>Monitoring & Drift</h2>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Metric</th>
                                <th>Method</th>
                                <th>Alert Threshold</th>
                                <th>Response</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Prediction score drift</td>
                                <td>PSI on score distribution</td>
                                <td>> 0.1</td>
                                <td>Investigate feature drift</td>
                            </tr>
                            <tr>
                                <td>Feature drift</td>
                                <td>KS test on 20 key features</td>
                                <td>p < 0.01 on >3 features</td>
                                <td>Check upstream data</td>
                            </tr>
                            <tr>
                                <td>Base rate drift</td>
                                <td>7-day rolling fraud rate</td>
                                <td>> 20% deviation from baseline</td>
                                <td>Trigger recalibration</td>
                            </tr>
                            <tr>
                                <td>Feature null-rate spike</td>
                                <td>Null % per feature</td>
                                <td>> 5% increase</td>
                                <td>Check data pipeline</td>
                            </tr>
                            <tr>
                                <td>Schema change</td>
                                <td>Contract validation</td>
                                <td>Any schema mismatch</td>
                                <td>Block pipeline, alert</td>
                            </tr>
                            <tr>
                                <td>Feature computation lag</td>
                                <td>Streaming lag metrics</td>
                                <td>> 5 min behind</td>
                                <td>Scale workers</td>
                            </tr>
                            <tr>
                                <td>Label freshness</td>
                                <td>Days since last label batch</td>
                                <td>> 45 days</td>
                                <td>Check label pipeline</td>
                            </tr>
                            <tr>
                                <td>Latency p95</td>
                                <td>Service metrics</td>
                                <td>> 50ms</td>
                                <td>Scale or optimize</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="eval-note">See <a href="https://github.com/Croesus245/My-POrt/blob/main/fraudshield/docs/drift_runbook.md" target="_blank">Drift Runbook</a> for detailed response procedures.</p>
                    <p class="ownership-note"><strong>Ownership:</strong> On-call owns drift/latency alerts. Data Eng owns schema/lag. ML Eng owns recalibration + model updates.</p>
                </section>

                <!-- Cost/Latency -->
                <section class="case-section">
                    <h2>Cost & Latency</h2>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <span class="metric-value">~15ms</span>
                            <span class="metric-label">p50 Latency</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value">~45ms</span>
                            <span class="metric-label">p95 Latency</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value">~1.2K</span>
                            <span class="metric-label">TPS (single instance)</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-value">~$360</span>
                            <span class="metric-label">Monthly (estimated)</span>
                        </div>
                    </div>
                    <div class="how-measured">
                        <strong>How measured:</strong>
                        <ul>
                            <li><strong>Latency:</strong> uvicorn workers=4, batch=1, 1KB payload, 1000-request benchmark on local machine</li>
                            <li><strong>TPS:</strong> Single c5.xlarge equivalent, no batching. Scales linearly with instances.</li>
                            <li><strong>Cost:</strong> AWS pricing estimate: 2Ã— c5.xlarge ($248) + Redis cache.t3.medium ($25) + storage/egress (~$90). Does not include Kafka (use managed or self-host).</li>
                        </ul>
                        <p><em>Note: Production deployment would need load testing with realistic traffic patterns.</em></p>
                    </div>
                </section>

                <!-- Failure Modes -->
                <section class="case-section">
                    <h2>Failure Modes</h2>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Failure Mode</th>
                                <th>Likelihood</th>
                                <th>Impact</th>
                                <th>Mitigation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Model scores all low-risk</td>
                                <td>Medium</td>
                                <td>High</td>
                                <td>Minimum fraud rate alert</td>
                            </tr>
                            <tr>
                                <td>Latency spike</td>
                                <td>Medium</td>
                                <td>Medium</td>
                                <td>Circuit breaker + rule fallback</td>
                            </tr>
                            <tr>
                                <td>Label pipeline breaks</td>
                                <td>Low</td>
                                <td>High</td>
                                <td>Label freshness alert (>45 days)</td>
                            </tr>
                            <tr>
                                <td>Adversarial fraud pattern</td>
                                <td>High</td>
                                <td>High</td>
                                <td>Drift detection + rapid retrain</td>
                            </tr>
                            <tr>
                                <td>Reason-code drift / feature leakage</td>
                                <td>Low</td>
                                <td>Medium</td>
                                <td>Feature importance drift checks (SHAP optional) + top feature review</td>
                            </tr>
                            <tr>
                                <td>Upstream schema change</td>
                                <td>Medium</td>
                                <td>High</td>
                                <td>Data contract validation blocks pipeline</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="residual-risk">
                        <strong>Residual Risk:</strong> The system cannot detect zero-day fraud patterns until labeled examples arrive (30+ day lag). Mitigation: rule-based fallback for anomalous transactions + human review queue.
                    </div>
                </section>

                <!-- Incident Simulation -->
                <section class="case-section">
                    <h2>Incident Simulation</h2>
                    <div class="incident-box">
                        <h3>What I Broke</h3>
                        <p>Injected a synthetic fraud pattern shift mid-stream: new fraud type targeting a previously safe merchant category (simulated "travel" category attack).</p>
                        
                        <h3>What Happened</h3>
                        <ul>
                            <li>Drift monitor detected PSI spike (0.15 > 0.1 threshold)</li>
                            <li>Feature KS test flagged <code>merchant_category</code> distribution shift</li>
                            <li>Slice analysis showed "travel" category PR-AUC dropped from 0.84 â†’ 0.61</li>
                            <li>Retraining trigger fired automatically</li>
                            <li>New model trained and validated against regression suite</li>
                        </ul>
                        
                        <h3>Postmortem</h3>
                        <p>Full postmortem documented with timeline, root cause, and prevention measures. <a href="https://github.com/Croesus245/My-POrt/blob/main/fraudshield/docs/postmortem.md" target="_blank">View postmortem â†’</a></p>
                    </div>
                </section>

                <!-- Assumptions -->
                <section class="case-section assumptions-box">
                    <h2>Assumptions & Limitations</h2>
                    <ul>
                        <li><strong>Synthetic data:</strong> Demo uses generated transactions (no real PII). Patterns are realistic but not from production.</li>
                        <li><strong>Simulated delay:</strong> 30â€“90 day label lag is simulated by holding back labels, not real chargebacks.</li>
                        <li><strong>Local benchmarks:</strong> Latency/TPS measured on dev machine, not production infrastructure.</li>
                        <li><strong>Mock streaming:</strong> Demo uses mock stream for portability. Kafka consumer/producer stubs included; diagram shows target architecture.</li>
                    </ul>
                </section>

                <!-- Data Contract -->
                <section class="case-section">
                    <h2>Data Contract (excerpt)</h2>
                    <div class="code-block">
                        <pre><code>TransactionEvent:
  required:
    - transaction_id: string (uuid)
    - amount: float (>0)
    - user_id: string
    - merchant_id: string
    - timestamp: datetime (ISO8601)
  optional:
    - device_id: string | null
    - ip_address: string | null
  null_policy: "device_id nullable, others reject on null"</code></pre>
                    </div>
                    <p class="eval-note-small">(Each API request is validated and becomes a TransactionEvent internally.)</p>
                </section>

                <!-- Reason Codes -->
                <section class="case-section">
                    <h2>Reason Codes (sample)</h2>
                    <p>Top reason codes for a high-risk decision:</p>
                    <div class="reason-codes">
                        <span class="reason-code">velocity_user_1h_high</span>
                        <span class="reason-code">new_device_high_amount</span>
                        <span class="reason-code">merchant_category_risk</span>
                        <span class="reason-code">time_since_last_txn_low</span>
                    </div>
                    <p class="reason-code-explain"><code>velocity_user_1h_high</code> â€” User initiated >N transactions in the last hour (threshold varies by user history)</p>
                    <p class="eval-note-small">Reason codes derived from SHAP values + rule triggers. Used for analyst review and model debugging.</p>
                </section>

                <!-- Links -->
                <section class="case-section">
                    <h2>Artifacts</h2>
                    <div class="artifacts-grid">
                        <a href="https://github.com/Croesus245/My-POrt/blob/main/fraudshield/docs/eval_report.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">ğŸ“Š</span>
                            <span>Eval Report</span>
                        </a>
                        <a href="https://github.com/Croesus245/My-POrt/blob/main/fraudshield/docs/drift_runbook.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">ğŸ“ˆ</span>
                            <span>Drift Runbook</span>
                        </a>
                        <a href="https://github.com/Croesus245/My-POrt/blob/main/fraudshield/docs/postmortem.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">ğŸ”¥</span>
                            <span>Postmortem</span>
                        </a>
                        <a href="https://github.com/Croesus245/My-POrt/blob/main/fraudshield/docs/model_card.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">ğŸ“‹</span>
                            <span>Model Card</span>
                        </a>
                        <a href="https://github.com/Croesus245/My-POrt/blob/main/fraudshield/docs/cost_report.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">ğŸ’°</span>
                            <span>Cost Report</span>
                        </a>
                        <a href="https://github.com/Croesus245/My-POrt/tree/main/fraudshield" class="artifact-link" target="_blank">
                            <span class="artifact-icon">ğŸ“¦</span>
                            <span>Repository</span>
                        </a>
                    </div>
                </section>
            </div>

            <!-- Navigation -->
            <nav class="case-nav">
                <a href="../work.html" class="case-nav-link">â† Back to Work</a>
                <a href="securerag.html" class="case-nav-link">Next: SecureRAG â†’</a>
            </nav>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>Â© 2025 Abdul-Sobur Ayinde Â· <a href="../contact.html">Get in touch</a></p>
        </div>
    </footer>

    <script src="../app.js"></script>
    <script>
        // Demo transaction scenarios
        const transactions = [
            { amount: 847.50, user_id: "u_12345", merchant_id: "m_travel_05", channel: "card_not_present", score: 0.73, decision: "review", reasons: ["velocity_user_1h_high", "new_merchant_high_amount"] },
            { amount: 2499.99, user_id: "u_78234", merchant_id: "m_electronics_12", channel: "mobile", score: 0.91, decision: "block", reasons: ["amount_zscore_extreme", "device_first_seen", "geo_anomaly"] },
            { amount: 34.50, user_id: "u_55123", merchant_id: "m_grocery_01", channel: "chip", score: 0.08, decision: "allow", reasons: [] },
            { amount: 199.00, user_id: "u_99821", merchant_id: "m_gaming_08", channel: "card_not_present", score: 0.52, decision: "review", reasons: ["merchant_category_risk", "time_of_day_unusual"] },
            { amount: 5200.00, user_id: "u_00412", merchant_id: "m_jewelry_03", channel: "card_not_present", score: 0.88, decision: "block", reasons: ["high_value_new_merchant", "velocity_spike", "card_not_present_risk"] }
        ];

        let txnIndex = 0;

        function scoreTransaction() {
            const btn = document.getElementById('score-btn');
            btn.classList.add('loading');
            
            setTimeout(() => {
                const txn = transactions[txnIndex % transactions.length];
                txnIndex++;
                
                const request = {
                    amount: txn.amount,
                    user_id: txn.user_id,
                    merchant_id: txn.merchant_id,
                    channel: txn.channel
                };
                
                const response = {
                    score: txn.score,
                    decision: txn.decision,
                    reason_codes: txn.reasons,
                    model_version: "xgb_v0.3.1",
                    latency_ms: Math.floor(Math.random() * 20) + 12
                };
                
                const output = `// POST /predict
${JSON.stringify(request, null, 2)}

// Response (${response.latency_ms}ms)
${JSON.stringify(response, null, 2)}`;
                
                showOutput('ğŸ” Fraud Score Result', output, txn.decision);
                btn.classList.remove('loading');
            }, 300 + Math.random() * 200);
        }

        function triggerDrift() {
            const btn = document.getElementById('drift-btn');
            btn.classList.add('loading');
            
            setTimeout(() => {
                const psi = (0.15 + Math.random() * 0.1).toFixed(3);
                const affectedFeatures = ["merchant_category", "velocity_user_1h", "amount_zscore"];
                const shuffled = affectedFeatures.sort(() => Math.random() - 0.5);
                const driftedFeatures = shuffled.slice(0, Math.floor(Math.random() * 2) + 1);
                
                const alert = {
                    alert_type: "DRIFT_DETECTED",
                    severity: psi > 0.2 ? "critical" : "warning",
                    timestamp: new Date().toISOString(),
                    metrics: {
                        psi_score: parseFloat(psi),
                        threshold: 0.10,
                        drifted_features: driftedFeatures,
                        baseline_period: "2025-12-01 to 2025-12-20",
                        current_period: "2025-12-21 00:00 to now"
                    },
                    recommended_action: psi > 0.2 ? "TRIGGER_RETRAINING" : "INVESTIGATE",
                    runbook_link: "docs/drift_runbook.md"
                };
                
                const output = `// Drift simulation triggered
// Injecting distribution shift into merchant_category...

// ALERT FIRED
${JSON.stringify(alert, null, 2)}

// Slack notification sent to #ml-alerts`;
                
                showOutput('ğŸ“‰ Drift Alert', output, alert.severity);
                btn.classList.remove('loading');
            }, 500 + Math.random() * 300);
        }

        function showOutput(title, content, status) {
            const output = document.getElementById('demo-output');
            const titleEl = document.getElementById('demo-output-title');
            const contentEl = document.getElementById('demo-output-content');
            
            titleEl.textContent = title;
            contentEl.textContent = content;
            output.style.display = 'block';
            output.className = 'demo-output status-' + status;
            
            output.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function closeDemoOutput() {
            document.getElementById('demo-output').style.display = 'none';
        }
    </script>
    <style>
        .try-it-btn {
            cursor: pointer;
            border: none;
            background: var(--bg-card);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .try-it-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .try-it-btn:active {
            transform: translateY(0);
        }
        .try-it-btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }
        .try-it-btn.loading .try-it-icon {
            animation: pulse 0.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .demo-output {
            margin-top: 1.5rem;
            border-radius: 8px;
            border: 2px solid var(--accent);
            background: var(--bg-card);
            overflow: hidden;
        }
        .demo-output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--accent);
            color: white;
            font-weight: 600;
        }
        .demo-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
            opacity: 0.8;
        }
        .demo-close:hover { opacity: 1; }
        .demo-output pre {
            margin: 0;
            padding: 1rem;
            font-size: 0.85rem;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .demo-output.status-allow { border-color: #22c55e; }
        .demo-output.status-allow .demo-output-header { background: #22c55e; }
        .demo-output.status-review { border-color: #f59e0b; }
        .demo-output.status-review .demo-output-header { background: #f59e0b; }
        .demo-output.status-block { border-color: #ef4444; }
        .demo-output.status-block .demo-output-header { background: #ef4444; }
        .demo-output.status-warning { border-color: #f59e0b; }
        .demo-output.status-warning .demo-output-header { background: #f59e0b; }
        .demo-output.status-critical { border-color: #ef4444; }
        .demo-output.status-critical .demo-output-header { background: #ef4444; }
        .demo-disclaimer {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 0.75rem 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            color: #92400e;
        }
        .dataset-citation {
            background: var(--bg-card);
            border-left: 3px solid var(--accent);
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        .dataset-citation a {
            color: var(--accent);
        }
    </style>
</body>
</html>
