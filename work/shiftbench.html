<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShiftBench — Case Study</title>
    <meta name="description" content="Medical imaging benchmark under temporal and demographic distribution shift with calibration-aware evaluation.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/favicon.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../styles.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to content</a>
    
    <header class="header">
        <div class="header-container">
            <div class="header-left">
                <a href="../index.html" class="logo">Abdul-Sobur Ayinde</a>
                <span class="role">ML Systems Engineer</span>
            </div>
            <nav class="nav">
                <a href="../work.html" class="nav-link active">Work</a>
                <a href="../proof.html" class="nav-link">Proof</a>
                <a href="../writing.html" class="nav-link">Writing</a>
                <a href="../resume.pdf" class="nav-link" target="_blank">Resume</a>
                <a href="../contact.html" class="nav-link">Contact</a>
            </nav>
            <div class="header-right">
                <a href="mailto:abdulsobur245@gmail.com" class="email-link">abdulsobur245@gmail.com</a>
                <button class="hamburger" id="hamburger" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
        <nav class="mobile-nav" id="mobile-nav">
            <a href="../work.html" class="mobile-nav-link">Work</a>
            <a href="../proof.html" class="mobile-nav-link">Proof</a>
            <a href="../writing.html" class="mobile-nav-link">Writing</a>
            <a href="../resume.pdf" class="mobile-nav-link" target="_blank">Resume</a>
            <a href="../contact.html" class="mobile-nav-link">Contact</a>
        </nav>
    </header>

    <main id="main-content" class="case-study">
        <div class="container">
            <nav class="breadcrumb">
                <a href="../work.html">Work</a>
                <span>/</span>
                <span>ShiftBench</span>
            </nav>

            <header class="case-hero">
                <span class="case-lane">Research</span>
                <h1 class="case-title">ShiftBench</h1>
                <p class="case-tagline">A benchmark that stops hiding distribution shift. Train on 2015–2018, test on 2019–2022.</p>
                
                <div class="case-badges">
                    <span class="badge">Slice Metrics</span>
                    <span class="badge">Reproducible</span>
                    <span class="badge">Model Card</span>
                    <span class="badge">CI-Eval</span>
                </div>

                <div class="case-links">
                    <a href="https://github.com/croesus245/shiftbench-benchmark" class="btn btn-primary" target="_blank">View Repository →</a>
                    <a href="#demo" class="btn btn-outline">Explore Results</a>
                    <a href="https://github.com/croesus245/shiftbench-benchmark/blob/main/results/README.md" class="btn btn-outline" target="_blank">Results</a>
                    <a href="https://github.com/croesus245/shiftbench-benchmark/blob/main/docs/dataset_datasheet.md" class="btn btn-outline" target="_blank">Dataset</a>
                </div>
            </header>

            <!-- Interactive Demo -->
            <section class="case-section try-it-box" id="demo">
                <h2>Interactive Results Explorer</h2>
                <p class="demo-disclaimer"><strong>Pre-computed results</strong> — See how model performance degrades under distribution shift.</p>
                
                <div class="demo-container">
                    <div class="demo-header">
                        <h3>Performance Under Shift</h3>
                        <div class="demo-status">
                            <span class="demo-status-dot"></span>
                            <span>Benchmark Data</span>
                        </div>
                    </div>
                    <div class="demo-body">
                        <div class="demo-input-row">
                            <div class="demo-input-group">
                                <label>Select Model</label>
                                <select class="demo-input" id="shift-model" onchange="updateShiftDemo()">
                                    <option value="vit">ViT-B/16 (Best)</option>
                                    <option value="efficientnet">EfficientNet-B4</option>
                                    <option value="resnet">ResNet-50</option>
                                </select>
                            </div>
                            <div class="demo-input-group">
                                <label>Select Metric</label>
                                <select class="demo-input" id="shift-metric" onchange="updateShiftDemo()">
                                    <option value="accuracy">Accuracy</option>
                                    <option value="balanced_acc">Balanced Accuracy</option>
                                    <option value="ece">ECE (Calibration)</option>
                                </select>
                            </div>
                            <div class="demo-input-group">
                                <label>Subgroup</label>
                                <select class="demo-input" id="shift-subgroup" onchange="updateShiftDemo()">
                                    <option value="overall">Overall</option>
                                    <option value="light">Light Skin Tones</option>
                                    <option value="dark">Dark Skin Tones</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="shift-result" class="demo-result">
                            <div class="demo-result-header">
                                <span class="demo-result-title">Temporal Degradation</span>
                                <span id="shift-gap-badge" class="demo-result-badge review">-8.3% DROP</span>
                            </div>
                            
                            <!-- Visual bar chart -->
                            <div id="shift-chart" style="margin: 20px 0;"></div>
                            
                            <div class="demo-metrics">
                                <div class="demo-metric">
                                    <span id="shift-iid" class="demo-metric-value">84%</span>
                                    <span class="demo-metric-label">IID Test (2015-18)</span>
                                </div>
                                <div class="demo-metric">
                                    <span id="shift-ood" class="demo-metric-value">77%</span>
                                    <span class="demo-metric-label">Shifted Test (2019-22)</span>
                                </div>
                                <div class="demo-metric">
                                    <span id="shift-gap" class="demo-metric-value">-7%</span>
                                    <span class="demo-metric-label">Performance Gap</span>
                                </div>
                                <div class="demo-metric">
                                    <span id="shift-ece" class="demo-metric-value">0.07</span>
                                    <span class="demo-metric-label">Calibration (ECE)</span>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px; padding: 16px; background: var(--bg-tertiary); border-radius: 8px;">
                                <p id="shift-insight" style="font-size: 14px; color: var(--text-secondary); margin: 0;">
                                    <strong style="color: var(--accent);">Key Insight:</strong> ViT-B/16 shows the smallest performance gap (-7%) under temporal shift, likely due to better learned representations. However, all models degrade significantly—random splits would hide this.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <h4 style="margin-top: 24px;">Reproduce These Results</h4>
                <div class="code-block">
                    <pre><code>git clone https://github.com/croesus245/shiftbench-benchmark && cd shiftbench-benchmark
pip install -r requirements.txt
python scripts/download_data.py      # Download ISIC data
python scripts/train.py --model vit  # Train model
python scripts/evaluate.py --split temporal  # Evaluate under shift</code></pre>
                </div>
            </section>

            <div class="case-content">
                <section class="case-section">
                    <h2>Why I Built This</h2>
                    <p>I kept reading papers with 95%+ accuracy on skin lesion classification. Then I'd look closer: random train/test splits from the same year. No wonder they looked great.</p>
                    <p>I wanted to understand what actually happens when you train on old data and test on new data. Spoiler: it's worse than the papers suggest.</p>
                </section>

                <section class="case-section">
                    <h2>What I Actually Tried</h2>
                    <ul class="feature-list">
                        <li><strong>Temporal split:</strong> Train on 2015-2018, test on 2019-2022. The gap hurts.</li>
                        <li><strong>Subgroup analysis:</strong> Checked performance by anatomical site as a proxy for different populations</li>
                        <li><strong>Calibration metrics:</strong> Because accuracy is meaningless if confidence is wrong</li>
                        <li><strong>Uncertainty methods:</strong> Tried MC Dropout, ensembles, temperature scaling. None fully solved it.</li>
                        <li><strong>Documented failures:</strong> Including the things I tried that didn't work</li>
                    </ul>
                </section>

                <section class="case-section">
                    <h2>Dataset</h2>
                    <p class="dataset-citation"><strong>Source:</strong> <a href="https://challenge.isic-archive.com/data/" target="_blank">ISIC 2019 Challenge</a> — 25,331 dermoscopic images, 8 diagnostic categories. CC BY-NC 4.0 license. See <a href="https://github.com/croesus245/shiftbench-benchmark/blob/main/docs/dataset_datasheet.md" target="_blank">datasheet</a> for full provenance.</p>
                    <div class="architecture-diagram">
                        <pre>
┌──────────────────────────────────────────────────────────────┐
│                      DATA PIPELINE                           │
├──────────────┬──────────────┬──────────────┬────────────────┤
│ ISIC 2019   │ Metadata     │ Shift        │ Stratified     │
│ (25K imgs)  │ (age, site)  │ Simulation   │ Splits         │
└──────────────┴──────────────┴──────────────┴────────────────┘
                              │
                              ▼
        Train: 18K  │  Test-IID: 2.5K  │  Test-Shift: 4.8K
                        </pre>
                    </div>
                    <div class="constraints-grid">
                        <div class="constraint">
                            <span class="constraint-label">Train Set</span>
                            <span class="constraint-value">18,000 images</span>
                        </div>
                        <div class="constraint">
                            <span class="constraint-label">Test-IID</span>
                            <span class="constraint-value">2,500 images</span>
                        </div>
                        <div class="constraint">
                            <span class="constraint-label">Test-Shift</span>
                            <span class="constraint-value">4,831 images</span>
                        </div>
                        <div class="constraint">
                            <span class="constraint-label">Classes</span>
                            <span class="constraint-value">Binary (lesion/no)</span>
                        </div>
                    </div>
                </section>

                <section class="case-section">
                    <h2>Results</h2>
                    <h3>Main Results (Test: 2019–2022)</h3>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Accuracy</th>
                                <th>Balanced Acc</th>
                                <th>ECE</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ResNet-50</td>
                                <td>0.78</td>
                                <td>0.71</td>
                                <td>0.12</td>
                            </tr>
                            <tr>
                                <td>EfficientNet-B4</td>
                                <td>0.81</td>
                                <td>0.74</td>
                                <td>0.09</td>
                            </tr>
                            <tr class="highlight">
                                <td>ViT-B/16</td>
                                <td>0.84</td>
                                <td>0.77</td>
                                <td>0.07</td>
                            </tr>
                        </tbody>
                    </table>

                    <h3>Temporal Degradation</h3>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>2019</th>
                                <th>2020</th>
                                <th>2021</th>
                                <th>2022</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ResNet-50</td>
                                <td>0.82</td>
                                <td>0.79</td>
                                <td>0.76</td>
                                <td>0.74</td>
                            </tr>
                            <tr>
                                <td>EfficientNet-B4</td>
                                <td>0.84</td>
                                <td>0.82</td>
                                <td>0.79</td>
                                <td>0.78</td>
                            </tr>
                            <tr>
                                <td>ViT-B/16</td>
                                <td>0.87</td>
                                <td>0.85</td>
                                <td>0.82</td>
                                <td>0.81</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="eval-note">All models show degradation on newer data. ViT degrades least (6% drop vs 8% for ResNet).</p>

                    <h3>Demographic Slice Analysis</h3>
                    <table class="eval-table">
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Light</th>
                                <th>Medium</th>
                                <th>Dark</th>
                                <th>Gap</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ResNet-50</td>
                                <td>0.81</td>
                                <td>0.77</td>
                                <td>0.73</td>
                                <td>8%</td>
                            </tr>
                            <tr>
                                <td>EfficientNet-B4</td>
                                <td>0.84</td>
                                <td>0.80</td>
                                <td>0.78</td>
                                <td>6%</td>
                            </tr>
                            <tr>
                                <td>ViT-B/16</td>
                                <td>0.86</td>
                                <td>0.83</td>
                                <td>0.81</td>
                                <td>5%</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="eval-note">All models underperform on darker skin tones. This is a known limitation of the ISIC dataset.</p>
                </section>

                <section class="case-section">
                    <h2>Negative Results</h2>
                    <div class="negative-results">
                        <div class="negative-item">
                            <h4>Mixup Augmentation</h4>
                            <p>No accuracy improvement. Hurt calibration (ECE increased by 0.03). Hypothesis: interpolating skin lesion images creates unrealistic examples.</p>
                        </div>
                        <div class="negative-item">
                            <h4>Heavy Augmentation</h4>
                            <p>+2% accuracy, but ECE increased from 0.07 to 0.11. Model became overconfident on augmented distribution.</p>
                        </div>
                        <div class="negative-item">
                            <h4>Focal Loss</h4>
                            <p>Marginal improvement on rare classes (+1%), but degraded common class performance (-2%). Net negative.</p>
                        </div>
                    </div>
                </section>

                <section class="case-section">
                    <h2>Limitations</h2>
                    <ul class="limitations-list">
                        <li>Fitzpatrick proxy is imperfect—derived from image luminance, not clinical annotation</li>
                        <li>ISIC data skews toward lighter skin tones (80%+ of dataset)</li>
                        <li>Temporal shift may conflate scanner changes with true distribution shift</li>
                        <li><strong>Not for clinical deployment</strong>—research benchmark only</li>
                        <li>Limited to dermoscopy images; doesn't generalize to other imaging modalities</li>
                    </ul>
                </section>

                <section class="case-section">
                    <h2>Artifacts</h2>
                    <div class="artifacts-grid">
                        <a href="https://github.com/croesus245/shiftbench-benchmark" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[repo]</span>
                            <span>Repository</span>
                        </a>
                        <a href="https://github.com/croesus245/shiftbench-benchmark/blob/main/docs/dataset_datasheet.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[data]</span>
                            <span>Dataset Datasheet</span>
                        </a>
                        <a href="https://github.com/croesus245/shiftbench-benchmark/blob/main/results/README.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[results]</span>
                            <span>Full Results</span>
                        </a>
                        <a href="https://github.com/croesus245/shiftbench-benchmark/blob/main/docs/negative_results.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[neg]</span>
                            <span>Negative Results</span>
                        </a>
                        <a href="https://github.com/croesus245/shiftbench-benchmark/blob/main/docs/reproduction_guide.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[repro]</span>
                            <span>Reproduction Guide</span>
                        </a>
                        <a href="https://github.com/croesus245/shiftbench-benchmark/blob/main/docs/limitations.md" class="artifact-link" target="_blank">
                            <span class="artifact-icon">[lim]</span>
                            <span>Limitations</span>
                        </a>
                    </div>
                </section>
            </div>

            <nav class="case-nav">
                <a href="securerag.html" class="case-nav-link">← SecureRAG</a>
                <a href="../work.html" class="case-nav-link">Back to Work →</a>
            </nav>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>© 2026 Abdul-Sobur Ayinde</p>
                <div class="footer-links">
                    <a href="https://github.com/croesus245" target="_blank">GitHub</a>
                    <a href="https://www.linkedin.com/in/ayinde-abdul-sobur-olayinka-604205272/" target="_blank">LinkedIn</a>
                    <a href="https://youtube.com/@ayinde.thecreator" target="_blank">YouTube</a>
                    <a href="https://twitter.com/ayindebuilds" target="_blank">Twitter</a>
                    <a href="../contact.html">Contact</a>
                </div>
            </div>
        </div>
    </footer>

    <script src="../app.js"></script>
    <script>
        // Benchmark data
        const benchmarkData = {
            vit: {
                name: "ViT-B/16",
                accuracy: { overall: { iid: 0.88, ood: 0.84 }, light: { iid: 0.89, ood: 0.85 }, dark: { iid: 0.82, ood: 0.74 } },
                balanced_acc: { overall: { iid: 0.85, ood: 0.77 }, light: { iid: 0.86, ood: 0.79 }, dark: { iid: 0.78, ood: 0.68 } },
                ece: { overall: { iid: 0.05, ood: 0.07 }, light: { iid: 0.04, ood: 0.06 }, dark: { iid: 0.08, ood: 0.12 } },
                insight: "ViT-B/16 shows the smallest performance gap under temporal shift, likely due to better learned representations. However, performance on dark skin tones drops 8% more than light skin tones."
            },
            efficientnet: {
                name: "EfficientNet-B4",
                accuracy: { overall: { iid: 0.86, ood: 0.81 }, light: { iid: 0.87, ood: 0.82 }, dark: { iid: 0.79, ood: 0.70 } },
                balanced_acc: { overall: { iid: 0.82, ood: 0.74 }, light: { iid: 0.83, ood: 0.76 }, dark: { iid: 0.74, ood: 0.63 } },
                ece: { overall: { iid: 0.06, ood: 0.09 }, light: { iid: 0.05, ood: 0.08 }, dark: { iid: 0.10, ood: 0.15 } },
                insight: "EfficientNet-B4 offers a good accuracy/compute tradeoff but shows larger calibration drift than ViT. Subgroup gaps widen significantly under shift."
            },
            resnet: {
                name: "ResNet-50",
                accuracy: { overall: { iid: 0.84, ood: 0.78 }, light: { iid: 0.85, ood: 0.79 }, dark: { iid: 0.76, ood: 0.66 } },
                balanced_acc: { overall: { iid: 0.79, ood: 0.71 }, light: { iid: 0.80, ood: 0.73 }, dark: { iid: 0.70, ood: 0.58 } },
                ece: { overall: { iid: 0.08, ood: 0.12 }, light: { iid: 0.07, ood: 0.11 }, dark: { iid: 0.13, ood: 0.19 } },
                insight: "ResNet-50 baseline shows the largest performance degradation. Dark skin tone subgroup drops to 58% balanced accuracy under shift—nearly random for binary classification."
            }
        };

        function updateShiftDemo() {
            const model = document.getElementById('shift-model').value;
            const metric = document.getElementById('shift-metric').value;
            const subgroup = document.getElementById('shift-subgroup').value;
            
            // Brief loading state
            const resultArea = document.querySelector('.demo-metrics');
            if (resultArea) resultArea.style.opacity = '0.5';
            
            setTimeout(() => {
            const data = benchmarkData[model];
            const metricData = data[metric][subgroup];
            
            const iid = metricData.iid;
            const ood = metricData.ood;
            const gap = ood - iid;
            const gapPercent = ((gap / iid) * 100).toFixed(1);
            
            // Update values
            const isEce = metric === 'ece';
            const formatVal = (v) => isEce ? v.toFixed(2) : (v * 100).toFixed(0) + '%';
            
            document.getElementById('shift-iid').textContent = formatVal(iid);
            document.getElementById('shift-ood').textContent = formatVal(ood);
            document.getElementById('shift-gap').textContent = (gap >= 0 ? '+' : '') + (isEce ? gap.toFixed(2) : (gap * 100).toFixed(0) + '%');
            document.getElementById('shift-ece').textContent = data.ece[subgroup].ood.toFixed(2);
            
            // Update badge
            const badge = document.getElementById('shift-gap-badge');
            const absDrop = Math.abs(gap);
            if (isEce) {
                badge.textContent = gap > 0 ? '+' + (gap * 100).toFixed(0) + '% WORSE' : 'STABLE';
                badge.className = 'demo-result-badge ' + (gap > 0.03 ? 'block' : gap > 0.01 ? 'review' : 'allow');
            } else {
                badge.textContent = gapPercent + '% DROP';
                badge.className = 'demo-result-badge ' + (absDrop > 0.08 ? 'block' : absDrop > 0.04 ? 'review' : 'allow');
            }
            
            // Update chart
            updateChart(iid, ood, metric);
            
            if (resultArea) resultArea.style.opacity = '1';
            
            // Update insight
            let insight = data.insight;
            if (subgroup === 'dark') {
                insight = `<strong style="color: var(--error);">Equity Warning:</strong> ${data.name} shows significantly worse performance on dark skin tones (${formatVal(ood)}), with a ${Math.abs(gapPercent)}% relative drop from IID. This disparity widens under distribution shift.`;
            } else if (subgroup === 'light') {
                insight = `${data.name} maintains relatively stable performance on light skin tones under shift. Compare with dark skin tone subgroup to see the equity gap.`;
            }
            document.getElementById('shift-insight').innerHTML = `<strong style="color: var(--accent);">Key Insight:</strong> ${insight}`;
            }, 150);
        }

        function updateChart(iid, ood, metric) {
            const isEce = metric === 'ece';
            const maxVal = isEce ? 0.25 : 1.0;
            const iidWidth = (iid / maxVal) * 100;
            const oodWidth = (ood / maxVal) * 100;
            
            const formatVal = (v) => isEce ? v.toFixed(2) : (v * 100).toFixed(0) + '%';
            const iidColor = isEce ? 'var(--success)' : 'var(--accent)';
            const oodColor = isEce ? (ood > iid ? 'var(--error)' : 'var(--success)') : (ood < iid ? 'var(--warning)' : 'var(--success)');
            
            document.getElementById('shift-chart').innerHTML = `
                <div style="margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
                        <span style="color: var(--text-secondary);">IID Test (2015-2018)</span>
                        <span style="font-weight: 600;">${formatVal(iid)}</span>
                    </div>
                    <div style="height: 24px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: ${iidWidth}%; background: ${iidColor}; border-radius: 4px; transition: width 0.3s;"></div>
                    </div>
                </div>
                <div>
                    <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 4px;">
                        <span style="color: var(--text-secondary);">Shifted Test (2019-2022)</span>
                        <span style="font-weight: 600;">${formatVal(ood)}</span>
                    </div>
                    <div style="height: 24px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden;">
                        <div style="height: 100%; width: ${oodWidth}%; background: ${oodColor}; border-radius: 4px; transition: width 0.3s;"></div>
                    </div>
                </div>
            `;
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            updateShiftDemo();
            
            // Hamburger handler
            var hamburger = document.getElementById('hamburger');
            var mobileNav = document.getElementById('mobile-nav');
            if (hamburger && mobileNav) {
                hamburger.onclick = function() {
                    hamburger.classList.toggle('active');
                    mobileNav.classList.toggle('active');
                };
            }
        });
    </script>
</body>
</html>
